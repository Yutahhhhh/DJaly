# 開発ワークフローとデプロイ戦略

このドキュメントでは、Djalyプロジェクトにおけるブランチ戦略、開発フロー、およびリリースプロセスについて説明します。

## 1. ブランチ戦略 (Branching Strategy)

基本的には **GitHub Flow** に準拠したシンプルな戦略を採用しています。

### ブランチ構成
- **`main`**: プロダクションリリースのベースとなるデフォルトブランチです。常にデプロイ可能な状態を保ちます。
- **`feature/*`**: 新機能開発用のブランチです。`main` から派生し、開発完了後に `main` へマージします。
- **`fix/*`**: バグ修正用のブランチです。
- **`refactor/*`**: コードの構造改善やリファクタリング用のブランチです。
- **`chore/*`**: 依存関係の更新やドキュメント修正などの雑務用ブランチです。

### タグ付け
- **`v*` (例: `v1.0.0`)**: リリースバージョンを管理するためのGitタグです。このタグがプッシュされると、自動的にリリースパイプラインがトリガーされます。

## 2. 開発フロー (Development Flow)

### ローカル環境のセットアップ
プロジェクトのルートディレクトリで以下の手順を実行します。

1. **依存関係のインストール**
   ```bash
   pnpm install
   ```

2. **バックエンドのセットアップ**
   ```bash
   cd backend
   ./setup.sh
   ```

### 開発サーバーの起動
ターミナルで以下のコマンドを実行して、開発環境を立ち上げます。

1. **バックエンド (FastAPI)**
   ```bash
   pnpm backend:dev
   ```
   - ポート: `8001`
   - ホットリロード有効

2. **フロントエンド (Tauri/React)**
   ```bash
   pnpm tauri dev
   ```
   - デスクトップアプリとして起動します。

## 3. リリースとデプロイ (Release & Deployment)

GitHub Actionsを利用して、クロスプラットフォーム向けのビルドとリリースを自動化しています。

### リリースフロー
1. `package.json` と `src-tauri/tauri.conf.json` のバージョン番号を更新します。
2. 変更をコミットし、`main` ブランチにプッシュします。
3. バージョンタグを作成してプッシュします。
   ```bash
   git tag v0.1.0
   git push origin v0.1.0
   ```

### CI/CD パイプライン (`.github/workflows/release.yml`)
タグのプッシュを検知すると、以下のジョブが実行されます。

1. **環境セットアップ**: Node.js, Python, Rust環境を構築。
2. **依存関係インストール**: フロントエンド・バックエンドのライブラリをインストール。
3. **バックエンドビルド (Sidecar)**:
   - `pyinstaller` を使用してPythonバックエンドを単一の実行ファイルにビルドします。
   - プラットフォームごとのターゲット名（例: `djaly-server-aarch64-apple-darwin`）に変更し、`src-tauri/bin/` に配置します。
4. **Tauriビルド**:
   - フロントエンドをビルドし、RustでTauriアプリとしてパッケージングします。
   - バックエンドの実行ファイル（Sidecar）がアプリに同梱されます。
5. **GitHub Release作成**:
   - ビルド成果物（インストーラー等）を含むドラフトリリースを自動作成します。

### サポートプラットフォーム
マトリックスビルドにより、以下の環境向けのバイナリが生成されます。
- **macOS**: Apple Silicon (aarch64) / Intel (x86_64)
- **Windows**: x86_64
- **Linux**: Ubuntu (x86_64)
